package com.copart.helpers;


import net.masterthought.cucumber.Configuration;
import net.masterthought.cucumber.ReportBuilder;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;
import java.util.Properties;

public class TestReportHelper {

    private static String tags;
    private static String numOfThreads;
    private static String environmentType;
    private static String sourceEnvironmentType;
    private static String targetEnvironmentType;

    public static void generateCucumberReport() {

        tags = System.getProperty("tags");
        numOfThreads = System.getProperty("threadCount");
        environmentType = System.getProperty("environment");

        //below two applicable only for data comparison
        sourceEnvironmentType = System.getProperty("sourceEnvironment");
        targetEnvironmentType = System.getProperty("targetEnvironment");
        ;

        File reportOutputDirectory = new File("target");

        ArrayList<String> jsonFiles = new ArrayList<String>();
        jsonFiles.add("target/cucumber-report/cucumber.json");

        String projectName = "Solr Services Automation";

        Configuration configuration = new Configuration(reportOutputDirectory, projectName);

        try {
            FileOutputStream out = new FileOutputStream("src/test/resources/config/config.properties");
            FileInputStream in = new FileInputStream("src/test/resources/config/config.properties");
            Properties props = new Properties();
            props.load(in);
            in.close();
            props.setProperty("browserType", "chrome");
            props.setProperty("environmentType", environmentType);
            if (sourceEnvironmentType != null)
                props.setProperty("sourceEnvironmentType", sourceEnvironmentType);
            if (targetEnvironmentType != null)
                props.setProperty("targetEnvironmentType", targetEnvironmentType);

            props.setProperty("tags", tags);
            props.setProperty("chromeInstances", numOfThreads);
            props.store(out, null);
            out.close();
        } catch (Exception e) {
            System.out.println("Exception occurred while reading config.properties file");
            e.printStackTrace();
        }


        List<String> classificationFiles = new ArrayList<String>();
        classificationFiles.add("src/test/resources/config/config.properties");
        configuration.addClassificationFiles(classificationFiles);

        ReportBuilder reportBuilder = new ReportBuilder(jsonFiles, configuration);
        reportBuilder.generateReports();
    }

}
